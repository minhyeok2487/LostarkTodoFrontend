{"ast":null,"code":"import * as React from 'react';\nimport { useTheme } from '@mui/material/styles';\nimport { gridVisibleColumnDefinitionsSelector } from '../columns/gridColumnsSelector';\nimport { useGridLogger } from '../../utils/useGridLogger';\nimport { useGridApiEventHandler } from '../../utils/useGridApiEventHandler';\nimport { gridExpandedSortedRowEntriesSelector } from '../filter/gridFilterSelector';\nimport { useGridVisibleRows } from '../../utils/useGridVisibleRows';\nimport { GRID_CHECKBOX_SELECTION_COL_DEF } from '../../../colDef/gridCheckboxSelectionColDef';\nimport { gridClasses } from '../../../constants/gridClasses';\nimport { GridCellModes } from '../../../models/gridEditRowModel';\nimport { isNavigationKey } from '../../../utils/keyboardUtils';\nimport { GRID_DETAIL_PANEL_TOGGLE_FIELD } from '../../../constants/gridDetailPanelToggleField';\nimport { gridPinnedRowsSelector } from '../rows/gridRowsSelector';\nimport { unstable_gridFocusColumnGroupHeaderSelector } from '../focus';\nimport { gridColumnGroupsHeaderMaxDepthSelector } from '../columnGrouping/gridColumnGroupsSelector';\nimport { unstable_gridHeaderFilteringEditFieldSelector, unstable_gridHeaderFilteringMenuSelector } from '../headerFiltering/gridHeaderFilteringSelectors';\nimport { useGridRegisterPipeProcessor } from '../../core/pipeProcessing';\nfunction enrichPageRowsWithPinnedRows(apiRef, rows) {\n  const pinnedRows = gridPinnedRowsSelector(apiRef) || {};\n  return [...(pinnedRows.top || []), ...rows, ...(pinnedRows.bottom || [])];\n}\nconst getLeftColumnIndex = ({\n  currentColIndex,\n  firstColIndex,\n  lastColIndex,\n  direction\n}) => {\n  if (direction === 'rtl') {\n    if (currentColIndex < lastColIndex) {\n      return currentColIndex + 1;\n    }\n  } else if (direction === 'ltr') {\n    if (currentColIndex > firstColIndex) {\n      return currentColIndex - 1;\n    }\n  }\n  return null;\n};\nconst getRightColumnIndex = ({\n  currentColIndex,\n  firstColIndex,\n  lastColIndex,\n  direction\n}) => {\n  if (direction === 'rtl') {\n    if (currentColIndex > firstColIndex) {\n      return currentColIndex - 1;\n    }\n  } else if (direction === 'ltr') {\n    if (currentColIndex < lastColIndex) {\n      return currentColIndex + 1;\n    }\n  }\n  return null;\n};\n\n/**\n * @requires useGridSorting (method) - can be after\n * @requires useGridFilter (state) - can be after\n * @requires useGridColumns (state, method) - can be after\n * @requires useGridDimensions (method) - can be after\n * @requires useGridFocus (method) - can be after\n * @requires useGridScroll (method) - can be after\n * @requires useGridColumnSpanning (method) - can be after\n */\nexport const useGridKeyboardNavigation = (apiRef, props) => {\n  const logger = useGridLogger(apiRef, 'useGridKeyboardNavigation');\n  const initialCurrentPageRows = useGridVisibleRows(apiRef, props).rows;\n  const theme = useTheme();\n  const currentPageRows = React.useMemo(() => enrichPageRowsWithPinnedRows(apiRef, initialCurrentPageRows), [apiRef, initialCurrentPageRows]);\n  const headerFilteringEnabled =\n  // @ts-expect-error // TODO move relevant code to the `DataGridPro`\n  props.signature !== 'DataGrid' && props.unstable_headerFilters;\n\n  /**\n   * @param {number} colIndex Index of the column to focus\n   * @param {number} rowIndex index of the row to focus\n   * @param {string} closestColumnToUse Which closest column cell to use when the cell is spanned by `colSpan`.\n   * TODO replace with apiRef.current.moveFocusToRelativeCell()\n   */\n  const goToCell = React.useCallback((colIndex, rowId, closestColumnToUse = 'left') => {\n    const visibleSortedRows = gridExpandedSortedRowEntriesSelector(apiRef);\n    const nextCellColSpanInfo = apiRef.current.unstable_getCellColSpanInfo(rowId, colIndex);\n    if (nextCellColSpanInfo && nextCellColSpanInfo.spannedByColSpan) {\n      if (closestColumnToUse === 'left') {\n        colIndex = nextCellColSpanInfo.leftVisibleCellIndex;\n      } else if (closestColumnToUse === 'right') {\n        colIndex = nextCellColSpanInfo.rightVisibleCellIndex;\n      }\n    }\n    // `scrollToIndexes` requires a rowIndex relative to all visible rows.\n    // Those rows do not include pinned rows, but pinned rows do not need scroll anyway.\n    const rowIndexRelativeToAllRows = visibleSortedRows.findIndex(row => row.id === rowId);\n    logger.debug(`Navigating to cell row ${rowIndexRelativeToAllRows}, col ${colIndex}`);\n    apiRef.current.scrollToIndexes({\n      colIndex,\n      rowIndex: rowIndexRelativeToAllRows\n    });\n    const field = apiRef.current.getVisibleColumns()[colIndex].field;\n    apiRef.current.setCellFocus(rowId, field);\n  }, [apiRef, logger]);\n  const goToHeader = React.useCallback((colIndex, event) => {\n    logger.debug(`Navigating to header col ${colIndex}`);\n    apiRef.current.scrollToIndexes({\n      colIndex\n    });\n    const field = apiRef.current.getVisibleColumns()[colIndex].field;\n    apiRef.current.setColumnHeaderFocus(field, event);\n  }, [apiRef, logger]);\n  const goToHeaderFilter = React.useCallback((colIndex, event) => {\n    logger.debug(`Navigating to header filter col ${colIndex}`);\n    apiRef.current.scrollToIndexes({\n      colIndex\n    });\n    const field = apiRef.current.getVisibleColumns()[colIndex].field;\n    apiRef.current.setColumnHeaderFilterFocus(field, event);\n  }, [apiRef, logger]);\n  const goToGroupHeader = React.useCallback((colIndex, depth, event) => {\n    logger.debug(`Navigating to header col ${colIndex}`);\n    apiRef.current.scrollToIndexes({\n      colIndex\n    });\n    const {\n      field\n    } = apiRef.current.getVisibleColumns()[colIndex];\n    apiRef.current.setColumnGroupHeaderFocus(field, depth, event);\n  }, [apiRef, logger]);\n  const getRowIdFromIndex = React.useCallback(rowIndex => {\n    var _currentPageRows$rowI;\n    return (_currentPageRows$rowI = currentPageRows[rowIndex]) == null ? void 0 : _currentPageRows$rowI.id;\n  }, [currentPageRows]);\n  const handleColumnHeaderKeyDown = React.useCallback((params, event) => {\n    const headerTitleNode = event.currentTarget.querySelector(`.${gridClasses.columnHeaderTitleContainerContent}`);\n    const isFromInsideContent = !!headerTitleNode && headerTitleNode.contains(event.target);\n    if (isFromInsideContent && params.field !== GRID_CHECKBOX_SELECTION_COL_DEF.field) {\n      // When focus is on a nested input, keyboard events have no effect to avoid conflicts with native events.\n      // There is one exception for the checkBoxHeader\n      return;\n    }\n    const dimensions = apiRef.current.getRootDimensions();\n    if (!dimensions) {\n      return;\n    }\n    const viewportPageSize = apiRef.current.getViewportPageSize();\n    const colIndexBefore = params.field ? apiRef.current.getColumnIndex(params.field) : 0;\n    const firstRowIndexInPage = currentPageRows.length > 0 ? 0 : null;\n    const lastRowIndexInPage = currentPageRows.length - 1;\n    const firstColIndex = 0;\n    const lastColIndex = gridVisibleColumnDefinitionsSelector(apiRef).length - 1;\n    const columnGroupMaxDepth = gridColumnGroupsHeaderMaxDepthSelector(apiRef);\n    let shouldPreventDefault = true;\n    switch (event.key) {\n      case 'ArrowDown':\n        {\n          if (firstRowIndexInPage !== null) {\n            if (headerFilteringEnabled) {\n              goToHeaderFilter(colIndexBefore, event);\n            } else {\n              goToCell(colIndexBefore, getRowIdFromIndex(firstRowIndexInPage));\n            }\n          }\n          break;\n        }\n      case 'ArrowRight':\n        {\n          const rightColIndex = getRightColumnIndex({\n            currentColIndex: colIndexBefore,\n            firstColIndex,\n            lastColIndex,\n            direction: theme.direction\n          });\n          if (rightColIndex !== null) {\n            goToHeader(rightColIndex, event);\n          }\n          break;\n        }\n      case 'ArrowLeft':\n        {\n          const leftColIndex = getLeftColumnIndex({\n            currentColIndex: colIndexBefore,\n            firstColIndex,\n            lastColIndex,\n            direction: theme.direction\n          });\n          if (leftColIndex !== null) {\n            goToHeader(leftColIndex, event);\n          }\n          break;\n        }\n      case 'ArrowUp':\n        {\n          if (columnGroupMaxDepth > 0) {\n            goToGroupHeader(colIndexBefore, columnGroupMaxDepth - 1, event);\n          }\n          break;\n        }\n      case 'PageDown':\n        {\n          if (firstRowIndexInPage !== null && lastRowIndexInPage !== null) {\n            goToCell(colIndexBefore, getRowIdFromIndex(Math.min(firstRowIndexInPage + viewportPageSize, lastRowIndexInPage)));\n          }\n          break;\n        }\n      case 'Home':\n        {\n          goToHeader(firstColIndex, event);\n          break;\n        }\n      case 'End':\n        {\n          goToHeader(lastColIndex, event);\n          break;\n        }\n      case 'Enter':\n        {\n          if (event.ctrlKey || event.metaKey) {\n            apiRef.current.toggleColumnMenu(params.field);\n          }\n          break;\n        }\n      case ' ':\n        {\n          // prevent Space event from scrolling\n          break;\n        }\n      default:\n        {\n          shouldPreventDefault = false;\n        }\n    }\n    if (shouldPreventDefault) {\n      event.preventDefault();\n    }\n  }, [apiRef, currentPageRows.length, headerFilteringEnabled, goToHeaderFilter, goToCell, getRowIdFromIndex, theme.direction, goToHeader, goToGroupHeader]);\n  const handleHeaderFilterKeyDown = React.useCallback((params, event) => {\n    const dimensions = apiRef.current.getRootDimensions();\n    if (!dimensions) {\n      return;\n    }\n    const isEditing = unstable_gridHeaderFilteringEditFieldSelector(apiRef) === params.field;\n    const isHeaderMenuOpen = unstable_gridHeaderFilteringMenuSelector(apiRef) === params.field;\n    if (isEditing || isHeaderMenuOpen || !isNavigationKey(event.key)) {\n      return;\n    }\n    const viewportPageSize = apiRef.current.getViewportPageSize();\n    const colIndexBefore = params.field ? apiRef.current.getColumnIndex(params.field) : 0;\n    const firstRowIndexInPage = 0;\n    const lastRowIndexInPage = currentPageRows.length - 1;\n    const firstColIndex = 0;\n    const lastColIndex = gridVisibleColumnDefinitionsSelector(apiRef).length - 1;\n    let shouldPreventDefault = true;\n    switch (event.key) {\n      case 'ArrowDown':\n        {\n          const rowId = getRowIdFromIndex(firstRowIndexInPage);\n          if (firstRowIndexInPage !== null && rowId != null) {\n            goToCell(colIndexBefore, rowId);\n          }\n          break;\n        }\n      case 'ArrowRight':\n        {\n          const rightColIndex = getRightColumnIndex({\n            currentColIndex: colIndexBefore,\n            firstColIndex,\n            lastColIndex,\n            direction: theme.direction\n          });\n          if (rightColIndex !== null) {\n            goToHeaderFilter(rightColIndex, event);\n          }\n          break;\n        }\n      case 'ArrowLeft':\n        {\n          const leftColIndex = getLeftColumnIndex({\n            currentColIndex: colIndexBefore,\n            firstColIndex,\n            lastColIndex,\n            direction: theme.direction\n          });\n          if (leftColIndex !== null) {\n            goToHeaderFilter(leftColIndex, event);\n          } else {\n            apiRef.current.setColumnHeaderFilterFocus(params.field, event);\n          }\n          break;\n        }\n      case 'ArrowUp':\n        {\n          goToHeader(colIndexBefore, event);\n          break;\n        }\n      case 'PageDown':\n        {\n          if (firstRowIndexInPage !== null && lastRowIndexInPage !== null) {\n            goToCell(colIndexBefore, getRowIdFromIndex(Math.min(firstRowIndexInPage + viewportPageSize, lastRowIndexInPage)));\n          }\n          break;\n        }\n      case 'Home':\n        {\n          goToHeaderFilter(firstColIndex, event);\n          break;\n        }\n      case 'End':\n        {\n          goToHeaderFilter(lastColIndex, event);\n          break;\n        }\n      case ' ':\n        {\n          // prevent Space event from scrolling\n          break;\n        }\n      default:\n        {\n          shouldPreventDefault = false;\n        }\n    }\n    if (shouldPreventDefault) {\n      event.preventDefault();\n    }\n  }, [apiRef, currentPageRows.length, goToHeaderFilter, theme.direction, goToHeader, goToCell, getRowIdFromIndex]);\n  const handleColumnGroupHeaderKeyDown = React.useCallback((params, event) => {\n    const dimensions = apiRef.current.getRootDimensions();\n    if (!dimensions) {\n      return;\n    }\n    const focusedColumnGroup = unstable_gridFocusColumnGroupHeaderSelector(apiRef);\n    if (focusedColumnGroup === null) {\n      return;\n    }\n    const {\n      field: currentField,\n      depth: currentDepth\n    } = focusedColumnGroup;\n    const {\n      fields,\n      depth,\n      maxDepth\n    } = params;\n    const viewportPageSize = apiRef.current.getViewportPageSize();\n    const currentColIndex = apiRef.current.getColumnIndex(currentField);\n    const colIndexBefore = currentField ? apiRef.current.getColumnIndex(currentField) : 0;\n    const firstRowIndexInPage = 0;\n    const lastRowIndexInPage = currentPageRows.length - 1;\n    const firstColIndex = 0;\n    const lastColIndex = gridVisibleColumnDefinitionsSelector(apiRef).length - 1;\n    let shouldPreventDefault = true;\n    switch (event.key) {\n      case 'ArrowDown':\n        {\n          if (depth === maxDepth - 1) {\n            goToHeader(currentColIndex, event);\n          } else {\n            goToGroupHeader(currentColIndex, currentDepth + 1, event);\n          }\n          break;\n        }\n      case 'ArrowUp':\n        {\n          if (depth > 0) {\n            goToGroupHeader(currentColIndex, currentDepth - 1, event);\n          }\n          break;\n        }\n      case 'ArrowRight':\n        {\n          const remainingRightColumns = fields.length - fields.indexOf(currentField) - 1;\n          if (currentColIndex + remainingRightColumns + 1 <= lastColIndex) {\n            goToGroupHeader(currentColIndex + remainingRightColumns + 1, currentDepth, event);\n          }\n          break;\n        }\n      case 'ArrowLeft':\n        {\n          const remainingLeftColumns = fields.indexOf(currentField);\n          if (currentColIndex - remainingLeftColumns - 1 >= firstColIndex) {\n            goToGroupHeader(currentColIndex - remainingLeftColumns - 1, currentDepth, event);\n          }\n          break;\n        }\n      case 'PageDown':\n        {\n          if (firstRowIndexInPage !== null && lastRowIndexInPage !== null) {\n            goToCell(colIndexBefore, getRowIdFromIndex(Math.min(firstRowIndexInPage + viewportPageSize, lastRowIndexInPage)));\n          }\n          break;\n        }\n      case 'Home':\n        {\n          goToGroupHeader(firstColIndex, currentDepth, event);\n          break;\n        }\n      case 'End':\n        {\n          goToGroupHeader(lastColIndex, currentDepth, event);\n          break;\n        }\n      case ' ':\n        {\n          // prevent Space event from scrolling\n          break;\n        }\n      default:\n        {\n          shouldPreventDefault = false;\n        }\n    }\n    if (shouldPreventDefault) {\n      event.preventDefault();\n    }\n  }, [apiRef, currentPageRows.length, goToHeader, goToGroupHeader, goToCell, getRowIdFromIndex]);\n  const handleCellKeyDown = React.useCallback((params, event) => {\n    // Ignore portal\n    if (!event.currentTarget.contains(event.target)) {\n      return;\n    }\n\n    // Get the most recent params because the cell mode may have changed by another listener\n    const cellParams = apiRef.current.getCellParams(params.id, params.field);\n    if (cellParams.cellMode === GridCellModes.Edit || !isNavigationKey(event.key)) {\n      return;\n    }\n    const canUpdateFocus = apiRef.current.unstable_applyPipeProcessors('canUpdateFocus', true, {\n      event,\n      cell: cellParams\n    });\n    if (!canUpdateFocus) {\n      return;\n    }\n    const dimensions = apiRef.current.getRootDimensions();\n    if (currentPageRows.length === 0 || !dimensions) {\n      return;\n    }\n    const direction = theme.direction;\n    const viewportPageSize = apiRef.current.getViewportPageSize();\n    const colIndexBefore = params.field ? apiRef.current.getColumnIndex(params.field) : 0;\n    const rowIndexBefore = currentPageRows.findIndex(row => row.id === params.id);\n    const firstRowIndexInPage = 0;\n    const lastRowIndexInPage = currentPageRows.length - 1;\n    const firstColIndex = 0;\n    const lastColIndex = gridVisibleColumnDefinitionsSelector(apiRef).length - 1;\n    let shouldPreventDefault = true;\n    switch (event.key) {\n      case 'ArrowDown':\n        {\n          // \"Enter\" is only triggered by the row / cell editing feature\n          if (rowIndexBefore < lastRowIndexInPage) {\n            goToCell(colIndexBefore, getRowIdFromIndex(rowIndexBefore + 1));\n          }\n          break;\n        }\n      case 'ArrowUp':\n        {\n          if (rowIndexBefore > firstRowIndexInPage) {\n            goToCell(colIndexBefore, getRowIdFromIndex(rowIndexBefore - 1));\n          } else if (headerFilteringEnabled) {\n            goToHeaderFilter(colIndexBefore, event);\n          } else {\n            goToHeader(colIndexBefore, event);\n          }\n          break;\n        }\n      case 'ArrowRight':\n        {\n          const rightColIndex = getRightColumnIndex({\n            currentColIndex: colIndexBefore,\n            firstColIndex,\n            lastColIndex,\n            direction\n          });\n          if (rightColIndex !== null) {\n            goToCell(rightColIndex, getRowIdFromIndex(rowIndexBefore), direction === 'rtl' ? 'left' : 'right');\n          }\n          break;\n        }\n      case 'ArrowLeft':\n        {\n          const leftColIndex = getLeftColumnIndex({\n            currentColIndex: colIndexBefore,\n            firstColIndex,\n            lastColIndex,\n            direction\n          });\n          if (leftColIndex !== null) {\n            goToCell(leftColIndex, getRowIdFromIndex(rowIndexBefore), direction === 'rtl' ? 'right' : 'left');\n          }\n          break;\n        }\n      case 'Tab':\n        {\n          // \"Tab\" is only triggered by the row / cell editing feature\n          if (event.shiftKey && colIndexBefore > firstColIndex) {\n            goToCell(colIndexBefore - 1, getRowIdFromIndex(rowIndexBefore), 'left');\n          } else if (!event.shiftKey && colIndexBefore < lastColIndex) {\n            goToCell(colIndexBefore + 1, getRowIdFromIndex(rowIndexBefore), 'right');\n          }\n          break;\n        }\n      case ' ':\n        {\n          const field = params.field;\n          if (field === GRID_DETAIL_PANEL_TOGGLE_FIELD) {\n            break;\n          }\n          const colDef = params.colDef;\n          if (colDef && colDef.type === 'treeDataGroup') {\n            break;\n          }\n          if (!event.shiftKey && rowIndexBefore < lastRowIndexInPage) {\n            goToCell(colIndexBefore, getRowIdFromIndex(Math.min(rowIndexBefore + viewportPageSize, lastRowIndexInPage)));\n          }\n          break;\n        }\n      case 'PageDown':\n        {\n          if (rowIndexBefore < lastRowIndexInPage) {\n            goToCell(colIndexBefore, getRowIdFromIndex(Math.min(rowIndexBefore + viewportPageSize, lastRowIndexInPage)));\n          }\n          break;\n        }\n      case 'PageUp':\n        {\n          // Go to the first row before going to header\n          const nextRowIndex = Math.max(rowIndexBefore - viewportPageSize, firstRowIndexInPage);\n          if (nextRowIndex !== rowIndexBefore && nextRowIndex >= firstRowIndexInPage) {\n            goToCell(colIndexBefore, getRowIdFromIndex(nextRowIndex));\n          } else {\n            goToHeader(colIndexBefore, event);\n          }\n          break;\n        }\n      case 'Home':\n        {\n          if (event.ctrlKey || event.metaKey || event.shiftKey) {\n            goToCell(firstColIndex, getRowIdFromIndex(firstRowIndexInPage));\n          } else {\n            goToCell(firstColIndex, getRowIdFromIndex(rowIndexBefore));\n          }\n          break;\n        }\n      case 'End':\n        {\n          if (event.ctrlKey || event.metaKey || event.shiftKey) {\n            goToCell(lastColIndex, getRowIdFromIndex(lastRowIndexInPage));\n          } else {\n            goToCell(lastColIndex, getRowIdFromIndex(rowIndexBefore));\n          }\n          break;\n        }\n      default:\n        {\n          shouldPreventDefault = false;\n        }\n    }\n    if (shouldPreventDefault) {\n      event.preventDefault();\n    }\n  }, [apiRef, currentPageRows, theme.direction, goToCell, getRowIdFromIndex, headerFilteringEnabled, goToHeaderFilter, goToHeader]);\n  const checkIfCanStartEditing = React.useCallback((initialValue, {\n    event\n  }) => {\n    if (event.key === ' ') {\n      // Space scrolls to the last row\n      return false;\n    }\n    return initialValue;\n  }, []);\n  useGridRegisterPipeProcessor(apiRef, 'canStartEditing', checkIfCanStartEditing);\n  useGridApiEventHandler(apiRef, 'columnHeaderKeyDown', handleColumnHeaderKeyDown);\n  useGridApiEventHandler(apiRef, 'headerFilterKeyDown', handleHeaderFilterKeyDown);\n  useGridApiEventHandler(apiRef, 'columnGroupHeaderKeyDown', handleColumnGroupHeaderKeyDown);\n  useGridApiEventHandler(apiRef, 'cellKeyDown', handleCellKeyDown);\n};","map":{"version":3,"names":["React","useTheme","gridVisibleColumnDefinitionsSelector","useGridLogger","useGridApiEventHandler","gridExpandedSortedRowEntriesSelector","useGridVisibleRows","GRID_CHECKBOX_SELECTION_COL_DEF","gridClasses","GridCellModes","isNavigationKey","GRID_DETAIL_PANEL_TOGGLE_FIELD","gridPinnedRowsSelector","unstable_gridFocusColumnGroupHeaderSelector","gridColumnGroupsHeaderMaxDepthSelector","unstable_gridHeaderFilteringEditFieldSelector","unstable_gridHeaderFilteringMenuSelector","useGridRegisterPipeProcessor","enrichPageRowsWithPinnedRows","apiRef","rows","pinnedRows","top","bottom","getLeftColumnIndex","currentColIndex","firstColIndex","lastColIndex","direction","getRightColumnIndex","useGridKeyboardNavigation","props","logger","initialCurrentPageRows","theme","currentPageRows","useMemo","headerFilteringEnabled","signature","unstable_headerFilters","goToCell","useCallback","colIndex","rowId","closestColumnToUse","visibleSortedRows","nextCellColSpanInfo","current","unstable_getCellColSpanInfo","spannedByColSpan","leftVisibleCellIndex","rightVisibleCellIndex","rowIndexRelativeToAllRows","findIndex","row","id","debug","scrollToIndexes","rowIndex","field","getVisibleColumns","setCellFocus","goToHeader","event","setColumnHeaderFocus","goToHeaderFilter","setColumnHeaderFilterFocus","goToGroupHeader","depth","setColumnGroupHeaderFocus","getRowIdFromIndex","_currentPageRows$rowI","handleColumnHeaderKeyDown","params","headerTitleNode","currentTarget","querySelector","columnHeaderTitleContainerContent","isFromInsideContent","contains","target","dimensions","getRootDimensions","viewportPageSize","getViewportPageSize","colIndexBefore","getColumnIndex","firstRowIndexInPage","length","lastRowIndexInPage","columnGroupMaxDepth","shouldPreventDefault","key","rightColIndex","leftColIndex","Math","min","ctrlKey","metaKey","toggleColumnMenu","preventDefault","handleHeaderFilterKeyDown","isEditing","isHeaderMenuOpen","handleColumnGroupHeaderKeyDown","focusedColumnGroup","currentField","currentDepth","fields","maxDepth","remainingRightColumns","indexOf","remainingLeftColumns","handleCellKeyDown","cellParams","getCellParams","cellMode","Edit","canUpdateFocus","unstable_applyPipeProcessors","cell","rowIndexBefore","shiftKey","colDef","type","nextRowIndex","max","checkIfCanStartEditing","initialValue"],"sources":["/Users/minhyeok/Desktop/LostarkTodo/Front/node_modules/@mui/x-data-grid/hooks/features/keyboardNavigation/useGridKeyboardNavigation.js"],"sourcesContent":["import * as React from 'react';\nimport { useTheme } from '@mui/material/styles';\nimport { gridVisibleColumnDefinitionsSelector } from '../columns/gridColumnsSelector';\nimport { useGridLogger } from '../../utils/useGridLogger';\nimport { useGridApiEventHandler } from '../../utils/useGridApiEventHandler';\nimport { gridExpandedSortedRowEntriesSelector } from '../filter/gridFilterSelector';\nimport { useGridVisibleRows } from '../../utils/useGridVisibleRows';\nimport { GRID_CHECKBOX_SELECTION_COL_DEF } from '../../../colDef/gridCheckboxSelectionColDef';\nimport { gridClasses } from '../../../constants/gridClasses';\nimport { GridCellModes } from '../../../models/gridEditRowModel';\nimport { isNavigationKey } from '../../../utils/keyboardUtils';\nimport { GRID_DETAIL_PANEL_TOGGLE_FIELD } from '../../../constants/gridDetailPanelToggleField';\nimport { gridPinnedRowsSelector } from '../rows/gridRowsSelector';\nimport { unstable_gridFocusColumnGroupHeaderSelector } from '../focus';\nimport { gridColumnGroupsHeaderMaxDepthSelector } from '../columnGrouping/gridColumnGroupsSelector';\nimport { unstable_gridHeaderFilteringEditFieldSelector, unstable_gridHeaderFilteringMenuSelector } from '../headerFiltering/gridHeaderFilteringSelectors';\nimport { useGridRegisterPipeProcessor } from '../../core/pipeProcessing';\nfunction enrichPageRowsWithPinnedRows(apiRef, rows) {\n  const pinnedRows = gridPinnedRowsSelector(apiRef) || {};\n  return [...(pinnedRows.top || []), ...rows, ...(pinnedRows.bottom || [])];\n}\nconst getLeftColumnIndex = ({\n  currentColIndex,\n  firstColIndex,\n  lastColIndex,\n  direction\n}) => {\n  if (direction === 'rtl') {\n    if (currentColIndex < lastColIndex) {\n      return currentColIndex + 1;\n    }\n  } else if (direction === 'ltr') {\n    if (currentColIndex > firstColIndex) {\n      return currentColIndex - 1;\n    }\n  }\n  return null;\n};\nconst getRightColumnIndex = ({\n  currentColIndex,\n  firstColIndex,\n  lastColIndex,\n  direction\n}) => {\n  if (direction === 'rtl') {\n    if (currentColIndex > firstColIndex) {\n      return currentColIndex - 1;\n    }\n  } else if (direction === 'ltr') {\n    if (currentColIndex < lastColIndex) {\n      return currentColIndex + 1;\n    }\n  }\n  return null;\n};\n\n/**\n * @requires useGridSorting (method) - can be after\n * @requires useGridFilter (state) - can be after\n * @requires useGridColumns (state, method) - can be after\n * @requires useGridDimensions (method) - can be after\n * @requires useGridFocus (method) - can be after\n * @requires useGridScroll (method) - can be after\n * @requires useGridColumnSpanning (method) - can be after\n */\nexport const useGridKeyboardNavigation = (apiRef, props) => {\n  const logger = useGridLogger(apiRef, 'useGridKeyboardNavigation');\n  const initialCurrentPageRows = useGridVisibleRows(apiRef, props).rows;\n  const theme = useTheme();\n  const currentPageRows = React.useMemo(() => enrichPageRowsWithPinnedRows(apiRef, initialCurrentPageRows), [apiRef, initialCurrentPageRows]);\n  const headerFilteringEnabled =\n  // @ts-expect-error // TODO move relevant code to the `DataGridPro`\n  props.signature !== 'DataGrid' && props.unstable_headerFilters;\n\n  /**\n   * @param {number} colIndex Index of the column to focus\n   * @param {number} rowIndex index of the row to focus\n   * @param {string} closestColumnToUse Which closest column cell to use when the cell is spanned by `colSpan`.\n   * TODO replace with apiRef.current.moveFocusToRelativeCell()\n   */\n  const goToCell = React.useCallback((colIndex, rowId, closestColumnToUse = 'left') => {\n    const visibleSortedRows = gridExpandedSortedRowEntriesSelector(apiRef);\n    const nextCellColSpanInfo = apiRef.current.unstable_getCellColSpanInfo(rowId, colIndex);\n    if (nextCellColSpanInfo && nextCellColSpanInfo.spannedByColSpan) {\n      if (closestColumnToUse === 'left') {\n        colIndex = nextCellColSpanInfo.leftVisibleCellIndex;\n      } else if (closestColumnToUse === 'right') {\n        colIndex = nextCellColSpanInfo.rightVisibleCellIndex;\n      }\n    }\n    // `scrollToIndexes` requires a rowIndex relative to all visible rows.\n    // Those rows do not include pinned rows, but pinned rows do not need scroll anyway.\n    const rowIndexRelativeToAllRows = visibleSortedRows.findIndex(row => row.id === rowId);\n    logger.debug(`Navigating to cell row ${rowIndexRelativeToAllRows}, col ${colIndex}`);\n    apiRef.current.scrollToIndexes({\n      colIndex,\n      rowIndex: rowIndexRelativeToAllRows\n    });\n    const field = apiRef.current.getVisibleColumns()[colIndex].field;\n    apiRef.current.setCellFocus(rowId, field);\n  }, [apiRef, logger]);\n  const goToHeader = React.useCallback((colIndex, event) => {\n    logger.debug(`Navigating to header col ${colIndex}`);\n    apiRef.current.scrollToIndexes({\n      colIndex\n    });\n    const field = apiRef.current.getVisibleColumns()[colIndex].field;\n    apiRef.current.setColumnHeaderFocus(field, event);\n  }, [apiRef, logger]);\n  const goToHeaderFilter = React.useCallback((colIndex, event) => {\n    logger.debug(`Navigating to header filter col ${colIndex}`);\n    apiRef.current.scrollToIndexes({\n      colIndex\n    });\n    const field = apiRef.current.getVisibleColumns()[colIndex].field;\n    apiRef.current.setColumnHeaderFilterFocus(field, event);\n  }, [apiRef, logger]);\n  const goToGroupHeader = React.useCallback((colIndex, depth, event) => {\n    logger.debug(`Navigating to header col ${colIndex}`);\n    apiRef.current.scrollToIndexes({\n      colIndex\n    });\n    const {\n      field\n    } = apiRef.current.getVisibleColumns()[colIndex];\n    apiRef.current.setColumnGroupHeaderFocus(field, depth, event);\n  }, [apiRef, logger]);\n  const getRowIdFromIndex = React.useCallback(rowIndex => {\n    var _currentPageRows$rowI;\n    return (_currentPageRows$rowI = currentPageRows[rowIndex]) == null ? void 0 : _currentPageRows$rowI.id;\n  }, [currentPageRows]);\n  const handleColumnHeaderKeyDown = React.useCallback((params, event) => {\n    const headerTitleNode = event.currentTarget.querySelector(`.${gridClasses.columnHeaderTitleContainerContent}`);\n    const isFromInsideContent = !!headerTitleNode && headerTitleNode.contains(event.target);\n    if (isFromInsideContent && params.field !== GRID_CHECKBOX_SELECTION_COL_DEF.field) {\n      // When focus is on a nested input, keyboard events have no effect to avoid conflicts with native events.\n      // There is one exception for the checkBoxHeader\n      return;\n    }\n    const dimensions = apiRef.current.getRootDimensions();\n    if (!dimensions) {\n      return;\n    }\n    const viewportPageSize = apiRef.current.getViewportPageSize();\n    const colIndexBefore = params.field ? apiRef.current.getColumnIndex(params.field) : 0;\n    const firstRowIndexInPage = currentPageRows.length > 0 ? 0 : null;\n    const lastRowIndexInPage = currentPageRows.length - 1;\n    const firstColIndex = 0;\n    const lastColIndex = gridVisibleColumnDefinitionsSelector(apiRef).length - 1;\n    const columnGroupMaxDepth = gridColumnGroupsHeaderMaxDepthSelector(apiRef);\n    let shouldPreventDefault = true;\n    switch (event.key) {\n      case 'ArrowDown':\n        {\n          if (firstRowIndexInPage !== null) {\n            if (headerFilteringEnabled) {\n              goToHeaderFilter(colIndexBefore, event);\n            } else {\n              goToCell(colIndexBefore, getRowIdFromIndex(firstRowIndexInPage));\n            }\n          }\n          break;\n        }\n      case 'ArrowRight':\n        {\n          const rightColIndex = getRightColumnIndex({\n            currentColIndex: colIndexBefore,\n            firstColIndex,\n            lastColIndex,\n            direction: theme.direction\n          });\n          if (rightColIndex !== null) {\n            goToHeader(rightColIndex, event);\n          }\n          break;\n        }\n      case 'ArrowLeft':\n        {\n          const leftColIndex = getLeftColumnIndex({\n            currentColIndex: colIndexBefore,\n            firstColIndex,\n            lastColIndex,\n            direction: theme.direction\n          });\n          if (leftColIndex !== null) {\n            goToHeader(leftColIndex, event);\n          }\n          break;\n        }\n      case 'ArrowUp':\n        {\n          if (columnGroupMaxDepth > 0) {\n            goToGroupHeader(colIndexBefore, columnGroupMaxDepth - 1, event);\n          }\n          break;\n        }\n      case 'PageDown':\n        {\n          if (firstRowIndexInPage !== null && lastRowIndexInPage !== null) {\n            goToCell(colIndexBefore, getRowIdFromIndex(Math.min(firstRowIndexInPage + viewportPageSize, lastRowIndexInPage)));\n          }\n          break;\n        }\n      case 'Home':\n        {\n          goToHeader(firstColIndex, event);\n          break;\n        }\n      case 'End':\n        {\n          goToHeader(lastColIndex, event);\n          break;\n        }\n      case 'Enter':\n        {\n          if (event.ctrlKey || event.metaKey) {\n            apiRef.current.toggleColumnMenu(params.field);\n          }\n          break;\n        }\n      case ' ':\n        {\n          // prevent Space event from scrolling\n          break;\n        }\n      default:\n        {\n          shouldPreventDefault = false;\n        }\n    }\n    if (shouldPreventDefault) {\n      event.preventDefault();\n    }\n  }, [apiRef, currentPageRows.length, headerFilteringEnabled, goToHeaderFilter, goToCell, getRowIdFromIndex, theme.direction, goToHeader, goToGroupHeader]);\n  const handleHeaderFilterKeyDown = React.useCallback((params, event) => {\n    const dimensions = apiRef.current.getRootDimensions();\n    if (!dimensions) {\n      return;\n    }\n    const isEditing = unstable_gridHeaderFilteringEditFieldSelector(apiRef) === params.field;\n    const isHeaderMenuOpen = unstable_gridHeaderFilteringMenuSelector(apiRef) === params.field;\n    if (isEditing || isHeaderMenuOpen || !isNavigationKey(event.key)) {\n      return;\n    }\n    const viewportPageSize = apiRef.current.getViewportPageSize();\n    const colIndexBefore = params.field ? apiRef.current.getColumnIndex(params.field) : 0;\n    const firstRowIndexInPage = 0;\n    const lastRowIndexInPage = currentPageRows.length - 1;\n    const firstColIndex = 0;\n    const lastColIndex = gridVisibleColumnDefinitionsSelector(apiRef).length - 1;\n    let shouldPreventDefault = true;\n    switch (event.key) {\n      case 'ArrowDown':\n        {\n          const rowId = getRowIdFromIndex(firstRowIndexInPage);\n          if (firstRowIndexInPage !== null && rowId != null) {\n            goToCell(colIndexBefore, rowId);\n          }\n          break;\n        }\n      case 'ArrowRight':\n        {\n          const rightColIndex = getRightColumnIndex({\n            currentColIndex: colIndexBefore,\n            firstColIndex,\n            lastColIndex,\n            direction: theme.direction\n          });\n          if (rightColIndex !== null) {\n            goToHeaderFilter(rightColIndex, event);\n          }\n          break;\n        }\n      case 'ArrowLeft':\n        {\n          const leftColIndex = getLeftColumnIndex({\n            currentColIndex: colIndexBefore,\n            firstColIndex,\n            lastColIndex,\n            direction: theme.direction\n          });\n          if (leftColIndex !== null) {\n            goToHeaderFilter(leftColIndex, event);\n          } else {\n            apiRef.current.setColumnHeaderFilterFocus(params.field, event);\n          }\n          break;\n        }\n      case 'ArrowUp':\n        {\n          goToHeader(colIndexBefore, event);\n          break;\n        }\n      case 'PageDown':\n        {\n          if (firstRowIndexInPage !== null && lastRowIndexInPage !== null) {\n            goToCell(colIndexBefore, getRowIdFromIndex(Math.min(firstRowIndexInPage + viewportPageSize, lastRowIndexInPage)));\n          }\n          break;\n        }\n      case 'Home':\n        {\n          goToHeaderFilter(firstColIndex, event);\n          break;\n        }\n      case 'End':\n        {\n          goToHeaderFilter(lastColIndex, event);\n          break;\n        }\n      case ' ':\n        {\n          // prevent Space event from scrolling\n          break;\n        }\n      default:\n        {\n          shouldPreventDefault = false;\n        }\n    }\n    if (shouldPreventDefault) {\n      event.preventDefault();\n    }\n  }, [apiRef, currentPageRows.length, goToHeaderFilter, theme.direction, goToHeader, goToCell, getRowIdFromIndex]);\n  const handleColumnGroupHeaderKeyDown = React.useCallback((params, event) => {\n    const dimensions = apiRef.current.getRootDimensions();\n    if (!dimensions) {\n      return;\n    }\n    const focusedColumnGroup = unstable_gridFocusColumnGroupHeaderSelector(apiRef);\n    if (focusedColumnGroup === null) {\n      return;\n    }\n    const {\n      field: currentField,\n      depth: currentDepth\n    } = focusedColumnGroup;\n    const {\n      fields,\n      depth,\n      maxDepth\n    } = params;\n    const viewportPageSize = apiRef.current.getViewportPageSize();\n    const currentColIndex = apiRef.current.getColumnIndex(currentField);\n    const colIndexBefore = currentField ? apiRef.current.getColumnIndex(currentField) : 0;\n    const firstRowIndexInPage = 0;\n    const lastRowIndexInPage = currentPageRows.length - 1;\n    const firstColIndex = 0;\n    const lastColIndex = gridVisibleColumnDefinitionsSelector(apiRef).length - 1;\n    let shouldPreventDefault = true;\n    switch (event.key) {\n      case 'ArrowDown':\n        {\n          if (depth === maxDepth - 1) {\n            goToHeader(currentColIndex, event);\n          } else {\n            goToGroupHeader(currentColIndex, currentDepth + 1, event);\n          }\n          break;\n        }\n      case 'ArrowUp':\n        {\n          if (depth > 0) {\n            goToGroupHeader(currentColIndex, currentDepth - 1, event);\n          }\n          break;\n        }\n      case 'ArrowRight':\n        {\n          const remainingRightColumns = fields.length - fields.indexOf(currentField) - 1;\n          if (currentColIndex + remainingRightColumns + 1 <= lastColIndex) {\n            goToGroupHeader(currentColIndex + remainingRightColumns + 1, currentDepth, event);\n          }\n          break;\n        }\n      case 'ArrowLeft':\n        {\n          const remainingLeftColumns = fields.indexOf(currentField);\n          if (currentColIndex - remainingLeftColumns - 1 >= firstColIndex) {\n            goToGroupHeader(currentColIndex - remainingLeftColumns - 1, currentDepth, event);\n          }\n          break;\n        }\n      case 'PageDown':\n        {\n          if (firstRowIndexInPage !== null && lastRowIndexInPage !== null) {\n            goToCell(colIndexBefore, getRowIdFromIndex(Math.min(firstRowIndexInPage + viewportPageSize, lastRowIndexInPage)));\n          }\n          break;\n        }\n      case 'Home':\n        {\n          goToGroupHeader(firstColIndex, currentDepth, event);\n          break;\n        }\n      case 'End':\n        {\n          goToGroupHeader(lastColIndex, currentDepth, event);\n          break;\n        }\n      case ' ':\n        {\n          // prevent Space event from scrolling\n          break;\n        }\n      default:\n        {\n          shouldPreventDefault = false;\n        }\n    }\n    if (shouldPreventDefault) {\n      event.preventDefault();\n    }\n  }, [apiRef, currentPageRows.length, goToHeader, goToGroupHeader, goToCell, getRowIdFromIndex]);\n  const handleCellKeyDown = React.useCallback((params, event) => {\n    // Ignore portal\n    if (!event.currentTarget.contains(event.target)) {\n      return;\n    }\n\n    // Get the most recent params because the cell mode may have changed by another listener\n    const cellParams = apiRef.current.getCellParams(params.id, params.field);\n    if (cellParams.cellMode === GridCellModes.Edit || !isNavigationKey(event.key)) {\n      return;\n    }\n    const canUpdateFocus = apiRef.current.unstable_applyPipeProcessors('canUpdateFocus', true, {\n      event,\n      cell: cellParams\n    });\n    if (!canUpdateFocus) {\n      return;\n    }\n    const dimensions = apiRef.current.getRootDimensions();\n    if (currentPageRows.length === 0 || !dimensions) {\n      return;\n    }\n    const direction = theme.direction;\n    const viewportPageSize = apiRef.current.getViewportPageSize();\n    const colIndexBefore = params.field ? apiRef.current.getColumnIndex(params.field) : 0;\n    const rowIndexBefore = currentPageRows.findIndex(row => row.id === params.id);\n    const firstRowIndexInPage = 0;\n    const lastRowIndexInPage = currentPageRows.length - 1;\n    const firstColIndex = 0;\n    const lastColIndex = gridVisibleColumnDefinitionsSelector(apiRef).length - 1;\n    let shouldPreventDefault = true;\n    switch (event.key) {\n      case 'ArrowDown':\n        {\n          // \"Enter\" is only triggered by the row / cell editing feature\n          if (rowIndexBefore < lastRowIndexInPage) {\n            goToCell(colIndexBefore, getRowIdFromIndex(rowIndexBefore + 1));\n          }\n          break;\n        }\n      case 'ArrowUp':\n        {\n          if (rowIndexBefore > firstRowIndexInPage) {\n            goToCell(colIndexBefore, getRowIdFromIndex(rowIndexBefore - 1));\n          } else if (headerFilteringEnabled) {\n            goToHeaderFilter(colIndexBefore, event);\n          } else {\n            goToHeader(colIndexBefore, event);\n          }\n          break;\n        }\n      case 'ArrowRight':\n        {\n          const rightColIndex = getRightColumnIndex({\n            currentColIndex: colIndexBefore,\n            firstColIndex,\n            lastColIndex,\n            direction\n          });\n          if (rightColIndex !== null) {\n            goToCell(rightColIndex, getRowIdFromIndex(rowIndexBefore), direction === 'rtl' ? 'left' : 'right');\n          }\n          break;\n        }\n      case 'ArrowLeft':\n        {\n          const leftColIndex = getLeftColumnIndex({\n            currentColIndex: colIndexBefore,\n            firstColIndex,\n            lastColIndex,\n            direction\n          });\n          if (leftColIndex !== null) {\n            goToCell(leftColIndex, getRowIdFromIndex(rowIndexBefore), direction === 'rtl' ? 'right' : 'left');\n          }\n          break;\n        }\n      case 'Tab':\n        {\n          // \"Tab\" is only triggered by the row / cell editing feature\n          if (event.shiftKey && colIndexBefore > firstColIndex) {\n            goToCell(colIndexBefore - 1, getRowIdFromIndex(rowIndexBefore), 'left');\n          } else if (!event.shiftKey && colIndexBefore < lastColIndex) {\n            goToCell(colIndexBefore + 1, getRowIdFromIndex(rowIndexBefore), 'right');\n          }\n          break;\n        }\n      case ' ':\n        {\n          const field = params.field;\n          if (field === GRID_DETAIL_PANEL_TOGGLE_FIELD) {\n            break;\n          }\n          const colDef = params.colDef;\n          if (colDef && colDef.type === 'treeDataGroup') {\n            break;\n          }\n          if (!event.shiftKey && rowIndexBefore < lastRowIndexInPage) {\n            goToCell(colIndexBefore, getRowIdFromIndex(Math.min(rowIndexBefore + viewportPageSize, lastRowIndexInPage)));\n          }\n          break;\n        }\n      case 'PageDown':\n        {\n          if (rowIndexBefore < lastRowIndexInPage) {\n            goToCell(colIndexBefore, getRowIdFromIndex(Math.min(rowIndexBefore + viewportPageSize, lastRowIndexInPage)));\n          }\n          break;\n        }\n      case 'PageUp':\n        {\n          // Go to the first row before going to header\n          const nextRowIndex = Math.max(rowIndexBefore - viewportPageSize, firstRowIndexInPage);\n          if (nextRowIndex !== rowIndexBefore && nextRowIndex >= firstRowIndexInPage) {\n            goToCell(colIndexBefore, getRowIdFromIndex(nextRowIndex));\n          } else {\n            goToHeader(colIndexBefore, event);\n          }\n          break;\n        }\n      case 'Home':\n        {\n          if (event.ctrlKey || event.metaKey || event.shiftKey) {\n            goToCell(firstColIndex, getRowIdFromIndex(firstRowIndexInPage));\n          } else {\n            goToCell(firstColIndex, getRowIdFromIndex(rowIndexBefore));\n          }\n          break;\n        }\n      case 'End':\n        {\n          if (event.ctrlKey || event.metaKey || event.shiftKey) {\n            goToCell(lastColIndex, getRowIdFromIndex(lastRowIndexInPage));\n          } else {\n            goToCell(lastColIndex, getRowIdFromIndex(rowIndexBefore));\n          }\n          break;\n        }\n      default:\n        {\n          shouldPreventDefault = false;\n        }\n    }\n    if (shouldPreventDefault) {\n      event.preventDefault();\n    }\n  }, [apiRef, currentPageRows, theme.direction, goToCell, getRowIdFromIndex, headerFilteringEnabled, goToHeaderFilter, goToHeader]);\n  const checkIfCanStartEditing = React.useCallback((initialValue, {\n    event\n  }) => {\n    if (event.key === ' ') {\n      // Space scrolls to the last row\n      return false;\n    }\n    return initialValue;\n  }, []);\n  useGridRegisterPipeProcessor(apiRef, 'canStartEditing', checkIfCanStartEditing);\n  useGridApiEventHandler(apiRef, 'columnHeaderKeyDown', handleColumnHeaderKeyDown);\n  useGridApiEventHandler(apiRef, 'headerFilterKeyDown', handleHeaderFilterKeyDown);\n  useGridApiEventHandler(apiRef, 'columnGroupHeaderKeyDown', handleColumnGroupHeaderKeyDown);\n  useGridApiEventHandler(apiRef, 'cellKeyDown', handleCellKeyDown);\n};"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}